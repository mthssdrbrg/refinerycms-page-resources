<div class='wym_box field resources_field'>
  <ul id='page_resources' class='clearfix'>
    <%= f.fields_for :resources do |resource_form| %>
      <li id='resource_<%= resource_form.object.id %>'>
        <%= resource_form.hidden_field :id %>
        <%= resource_form.object %>
        <% index = resource_form.object_name.split('[').last.split(']').first.to_i %>
        <%= hidden_field_tag "#{f.object_name.demodulize}[resources_attributes][#{index}][resource_page_id]", f.object.resource_page_id_for_resource_index(index) %>
      </li>
    <% end %>
    <li class='empty'>
      <%= hidden_field_tag "#{f.object_name.demodulize}[resources_attributes][#{f.object.resources.size}][id]" %>
    </li>
  </ul>
</div>